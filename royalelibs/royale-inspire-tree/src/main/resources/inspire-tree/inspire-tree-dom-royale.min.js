!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("inspire-tree")):"function"==typeof define&&define.amd?define(["lodash","inspire-tree"],t):e.InspireTreeDOM=t(e._,e.InspireTree)}(this,function(s,i){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var b="$NO_OP",g="a runtime error occured! Use Inferno in development environment to find the error.",e=!("undefined"==typeof window||!window.document),c=Array.isArray;function u(e){e=typeof e;return"string"==e||"number"==e}function k(e){return d(e)||D(e)}function $(e){return D(e)||!1===e||!0===e||d(e)}function C(e){return"function"==typeof e}function h(e){return"string"==typeof e}function f(e){return"number"==typeof e}function D(e){return null===e}function d(e){return void 0===e}function p(e,t){var n={};if(e)for(var o in e)n[o]=e[o];if(t)for(var r in t)n[r]=t[r];return n}var v="$";function m(e,t,n,o,r,i,a,s){return{childFlags:e,children:t,className:n,dom:null,flags:o,key:void 0===r?null:r,parentVNode:null,props:void 0===i?null:i,ref:void 0===a?null:a,type:s}}function a(e,t,n,o,r,i,a,s){r=void 0===r?1:r,t=m(r,o,n,e,a,i,s,t);return 0===r&&x(t,t.children),t}function l(e,t,n,o,r){0<(2&e)&&(e=t.prototype&&C(t.prototype.render)?4:8);var i=t.defaultProps;if(!k(i))for(var a in n=n||{},i)d(n[a])&&(n[a]=i[a]);if(0<(8&e)){var s=t.defaultHooks;if(!k(s))if(r)for(var l in s)d(r[l])&&(r[l]=s[l]);else r=s}o=m(1,null,null,e,o,n,r,t),t=S.createVNode;return C(t)&&t(o),o}function y(e,t){return m(1,k(e)?"":e,null,16,t,null,null,null)}function r(e){var t,n=e.props;return n&&(481&(t=e.flags)&&(void 0!==n.children&&k(e.children)&&x(e,n.children),void 0!==n.className&&(e.className=n.className||null,n.className=void 0)),void 0!==n.key&&(e.key=n.key,n.key=void 0),void 0!==n.ref&&(e.ref=8&t?p(e.ref,n.ref):n.ref,n.ref=void 0)),e}function w(e){var t,n=e.flags;if(14&n){var o,r=e.props;if(!D(r))for(var i in o={},r)o[i]=r[i];t=l(n,e.type,o,e.key,e.ref)}else 481&n?t=a(n,e.type,e.className,e.children,e.childFlags,e.props,e.key,e.ref):16&n?t=y(e.children,e.key):1024&n&&(t=e);return t}function _(){return y("",null)}function x(e,t){var n,o=1;if($(t))n=t;else if(h(t))o=2,n=y(t);else if(f(t))o=2,n=y(t+"");else if(c(t)){var r=t.length;if(0===r)n=null,o=1;else{!Object.isFrozen(t)&&!0!==t.$||(t=t.slice()),o=8;for(var i=0;i<r;i++){var a,s,l,d=t[i];if($(d)||c(d)){n=n||t.slice(0,i),function e(t,n,o,r){for(var i=t.length;o<i;o++){var a,s,l,d=t[o];$(d)||(a=r+v+o,c(d)?e(d,n,0,a):(u(d)?d=y(d,a):(l=h(s=d.key)&&s[0]===v,D(d.dom)&&!l||(d=w(d)),D(s)||l?d.key=a:d.key=r+s),n.push(d)))}}(t,n,i,"");break}u(d)?(n=n||t.slice(0,i)).push(y(d,v+i)):(l=d.key,a=D(d.dom),l=!(s=D(l))&&l[0]===v,!a||s||l?(n=n||t.slice(0,i),a&&!l||(d=w(d)),(s||l)&&(d.key=v+i),n.push(d)):n&&n.push(d))}(n=n||t).$=!0}}else D((n=t).dom)||(n=w(t)),o=2;return e.children=n,e.childFlags=o,e}var S={afterRender:null,beforeRender:null,createVNode:null,renderComplete:null},t="http://www.w3.org/1999/xlink",n="http://www.w3.org/XML/1998/namespace",N="http://www.w3.org/2000/svg",P={"xlink:actuate":t,"xlink:arcrole":t,"xlink:href":t,"xlink:role":t,"xlink:show":t,"xlink:title":t,"xlink:type":t,"xml:base":n,"xml:lang":n,"xml:space":n},O={},T=[];function L(e,t){e.appendChild(t)}function U(e,t,n){k(n)?L(e,t):e.insertBefore(t,n)}function E(e,t,n){e.replaceChild(t,n)}function M(e){for(var t;void 0!==(t=e.shift());)t()}var F={},I={};function A(e,t,n){var o,r=F[e],i=n.$EV;function a(e){var t=e.type;if((t="click"===t||"dblclick"===t)&&0!==e.button)return e.stopPropagation(),!1;e.stopPropagation=R;var n={dom:document};Object.defineProperty(e,"currentTarget",{configurable:!0,get:function(){return n.dom}}),function(e,t,n,o,r){for(var i=t;!D(i);){if(n&&i.disabled)return;var a=i.$EV;if(a){a=a[o];if(a&&(r.dom=i,a.event?a.event(a.data,e):a(e),e.cancelBubble))return}i=i.parentNode}}(e,e.target,t,o,n)}t?(r||(I[e]=(o=e,document.addEventListener(V(o),a),a),F[e]=0),(i=i||(n.$EV={}))[e]||F[e]++,i[e]=t):i&&i[e]&&(F[e]--,1===r&&(document.removeEventListener(V(e),I[e]),I[e]=null),i[e]=t)}function V(e){return e.substr(2).toLowerCase()}function R(){this.cancelBubble=!0,this.immediatePropagationStopped||this.stopImmediatePropagation()}function j(e,t){var n=document.createElement("i");return n.innerHTML=t,n.innerHTML===e.innerHTML}function B(e,t,n){var o;e[t]?(o=e[t]).event?o.event(o.data,n):o(n):e[t=t.toLowerCase()]&&e[t](n)}function o(a,s){function e(e){e.stopPropagation();var t=this.$V;if(t){var n,o=t.props||O,r=t.dom;if(h(a))B(o,a,e);else for(var i=0;i<a.length;i++)B(o,a[i],e);C(s)&&(t=(n=this.$V).props||O,s(t,r,!1,n))}}return Object.defineProperty(e,"wrapped",{configurable:!1,enumerable:!1,value:!0,writable:!1}),e}function W(e){return"checkbox"===e||"radio"===e}var H=o("onInput",X),q=o(["onClick","onChange"],X);function K(e){e.stopPropagation()}function X(e,t){var n=e.type,o=e.value,r=e.checked,i=e.multiple,a=e.defaultValue,e=!k(o);n&&n!==t.type&&t.setAttribute("type",n),k(i)||i===t.multiple||(t.multiple=i),k(a)||e||(t.defaultValue=a+""),W(n)?(e&&(t.value=o),k(r)||(t.checked=r)):e&&t.value!==o?(t.defaultValue=o,t.value=o):k(r)||(t.checked=r)}function Q(e,t){if("optgroup"===e.type){var n=e.children,o=e.childFlags;if(12&o)for(var r=0,i=n.length;r<i;r++)z(n[r],t);else 2===o&&z(n,t)}else z(e,t)}function z(e,t){var n=e.props||O,e=e.dom;e.value=n.value,c(t)&&-1!==t.indexOf(n.value)||n.value===t?e.selected=!0:k(t)&&k(n.selected)||(e.selected=n.selected||!1)}K.wrapped=!0;var G=o("onChange",Y);function Y(e,t,n,o){var r=Boolean(e.multiple);k(e.multiple)||r===t.multiple||(t.multiple=r);r=o.childFlags;if(0==(1&r)){var i=o.children,a=e.value;if(n&&k(a)&&(a=e.defaultValue),12&r)for(var s=0,l=i.length;s<l;s++)Q(i[s],a);else 2===r&&Q(i,a)}}var J=o("onInput",ee),Z=o("onChange");function ee(e,t,n){var o=e.value,r=t.value;k(o)?n&&(k(e=e.defaultValue)||e===r||(t.defaultValue=e,t.value=e)):r!==o&&(t.defaultValue=o,t.value=o)}function te(e,t,n,o,r,i){64&e?X(o,n):256&e?Y(o,n,r,t):128&e&&ee(o,n,r),i&&(n.$V=t)}function ne(e,t,n){var o;64&e?(o=t,W(n.type)?(o.onchange=q,o.onclick=K):o.oninput=H):256&e?t.onchange=G:128&e&&(n=n,(t=t).oninput=J,n.onChange&&(t.onchange=Z))}function oe(e){return e.type&&W(e.type)?!k(e.checked):!k(e.value)}function re(e,t){var n;ie(e),t&&e.dom&&(n=t,t=e.dom,n.removeChild(t),e.dom=null)}function ie(e){var t=e.flags;if(481&t){var n=e.ref,o=e.props;C(n)&&n(null);var r=e.children,n=e.childFlags;if(12&n?ae(r):2===n&&ie(r),!D(o))for(var i in o)switch(i){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":A(i,null,e.dom)}}else{r=e.children;r&&(14&t?(o=e.ref,4&t?(C(r.componentWillUnmount)&&r.componentWillUnmount(),C(o)&&o(null),r.$UN=!0,r.$LI&&ie(r.$LI)):(!k(o)&&C(o.onComponentWillUnmount)&&o.onComponentWillUnmount(e.dom,e.props||O),ie(r))):1024&t&&re(r,e.type))}}function ae(e){for(var t=0,n=e.length;t<n;t++)ie(e[t])}function se(e,t){ae(t),e.textContent=""}function le(e,t){switch(e){case"animationIterationCount":case"borderImageOutset":case"borderImageSlice":case"borderImageWidth":case"boxFlex":case"boxFlexGroup":case"boxOrdinalGroup":case"columnCount":case"fillOpacity":case"flex":case"flexGrow":case"flexNegative":case"flexOrder":case"flexPositive":case"flexShrink":case"floodOpacity":case"fontWeight":case"gridColumn":case"gridRow":case"lineClamp":case"lineHeight":case"opacity":case"order":case"orphans":case"stopOpacity":case"strokeDasharray":case"strokeDashoffset":case"strokeMiterlimit":case"strokeOpacity":case"strokeWidth":case"tabSize":case"widows":case"zIndex":case"zoom":return t;default:return t+"px"}}function de(e,t,n,i,o,r,a){switch(e){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":A(e,n,i);break;case"children":case"childrenType":case"className":case"defaultValue":case"key":case"multiple":case"ref":break;case"autoFocus":i.autofocus=!!n;break;case"allowfullscreen":case"autoplay":case"capture":case"checked":case"controls":case"default":case"disabled":case"hidden":case"indeterminate":case"loop":case"muted":case"novalidate":case"open":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"selected":i[e]=!!n;break;case"defaultChecked":case"value":case"volume":if(r&&"value"===e)return;var s=k(n)?"":n;i[e]!==s&&(i[e]=s);break;case"dangerouslySetInnerHTML":var l=t&&t.__html||"",d=n&&n.__html||"";l!==d&&(k(d)||j(i,d)||(D(a)||(12&a.childFlags?ae(a.children):2===a.childFlags&&ie(a.children),a.children=null,a.childFlags=1),i.innerHTML=d));break;default:"o"===e[0]&&"n"===e[1]?(s=n,l=i,d=(d=e).toLowerCase(),C(s)||k(s)?(c=l[d])&&c.wrapped||(l[d]=s):(c=s.event)&&C(c)&&(l[d]=(u=c,p=s,function(e){u(p.data,e)}))):k(n)?i.removeAttribute(e):"style"===e?function(e,t){var n,o,r=i.style;if(h(t))r.cssText=t;else if(k(e)||h(e))for(n in t)o=t[n],r[n]=f(o)?le(n,o):o;else{for(n in t)(o=t[n])!==e[n]&&(r[n]=f(o)?le(n,o):o);for(n in e)k(t[n])&&(r[n]="")}}(t,n):o&&P[e]?i.setAttributeNS(P[e],e,n):i.setAttribute(e,n)}var c,u,p}function ce(e,t,n,o,r){var i,a=!1,s=0<(448&t);for(i in s&&(a=oe(n))&&ne(t,o,n),n)de(i,null,n[i],o,r,a,null);s&&te(t,e,o,n,!0,a)}function ue(e,t,n,o){t=new t(n,o);if((e.children=t).$V=e,t.$BS=!1,t.context=o,t.props===O&&(t.props=n),t.$UN=!1,C(t.componentWillMount)){if(t.$BR=!0,t.componentWillMount(),t.$PSS){var r=t.state,i=t.$PS;if(D(r))t.state=i;else for(var a in i)r[a]=i[a];t.$PSS=!1,t.$PS=null}t.$BR=!1}C(S.beforeRender)&&S.beforeRender(t);var s,e=pe(t.render(n,t.state,o),e);return C(t.getChildContext)&&(s=t.getChildContext()),k(s)?t.$CX=o:t.$CX=p(o,s),C(S.afterRender)&&S.afterRender(t),t.$LI=e,t}function pe(e,t){return $(e)?e=_():u(e)?e=y(e,null):(e.dom&&(e=w(e)),14&e.flags&&(e.parentVNode=t)),e}function he(e,t,n,o){var r=e.flags;return 481&r?ge(e,t,n,o):14&r?function(e,t,n,o,r){var i,a=e.type,s=e.props||O,l=e.ref;r?(r=ue(e,a,s,n),e.dom=i=he(r.$LI,null,r.$CX,o),me(0,l,r),r.$UPD=!1):(a=pe(a(s,n),e),e.children=a,e.dom=i=he(a,null,n,o),ye(s,l,i));D(t)||L(t,i);return i}(e,t,n,o,0<(4&r)):512&r||16&r?fe(e,t):1024&r?(he(e.children,e.type,n,!1),e.dom=fe(_(),t)):void 0}function fe(e,t){e=e.dom=document.createTextNode(e.children);return D(t)||L(t,e),e}function ge(e,t,n,o){var r=e.flags,i=e.children,a=e.props,s=e.className,l=e.ref,d=e.childFlags;o=o||0<(32&r);var c,c=(c=e.type,!0===o?document.createElementNS(N,c):document.createElement(c));return e.dom=c,k(s)||""===s||(o?c.setAttribute("class",s):c.className=s),D(t)||L(t,c),0==(1&d)&&(t=!0===o&&"foreignObject"!==e.type,2===d?he(i,c,n,t):12&d&&ve(i,c,n,t)),D(a)||ce(e,r,a,c,o),C(l)&&be(c,l),c}function ve(e,t,n,o){for(var r=0,i=e.length;r<i;r++){var a=e[r];D(a.dom)||(e[r]=a=w(a)),he(a,t,n,o)}}function me(e,t,n){var o;C(t)&&t(n),C(n.componentDidMount)&&T.push((o=n,function(){o.componentDidMount()}))}function ye(e,t,n){var o,r,i;k(t)||(C(t.onComponentWillMount)&&t.onComponentWillMount(e),C(t.onComponentDidMount)&&T.push((o=t,r=n,i=e,function(){return o.onComponentDidMount(r,i)})))}function be(e,t){T.push(function(){return t(e)})}function ke(e,t,n,o){var r=e.children,i=e.props,a=e.className,s=e.flags,l=e.ref;if(o=o||0<(32&s),1!==t.nodeType||t.tagName.toLowerCase()!==e.type){var d=ge(e,null,n,o);e.dom=d,E(t.parentNode,d,t)}else{var c=(e.dom=t).firstChild,u=e.childFlags;if(0==(1&u)){for(var p=null;c;)p=c.nextSibling,8===c.nodeType&&("!"===c.data?t.replaceChild(document.createTextNode(""),c):t.removeChild(c)),c=p;if(c=t.firstChild,2===u)D(c)?he(r,t,n,o):(p=c.nextSibling,$e(r,c,n,o),c=p);else if(12&u)for(var h=0,f=r.length;h<f;h++){var g=r[h];D(c)?he(g,t,n,o):(p=c.nextSibling,$e(g,c,n,o),c=p)}for(;c;)p=c.nextSibling,t.removeChild(c),c=p}else D(t.firstChild)||(d=t,u=i,Boolean(u&&u.dangerouslySetInnerHTML&&u.dangerouslySetInnerHTML.__html&&j(d,u.dangerouslySetInnerHTML.__html)))||(t.textContent="",448&s&&(t.defaultValue=""));D(i)||ce(e,s,i,t,o),k(a)?""!==t.className&&t.removeAttribute("class"):o?t.setAttribute("class",a):t.className=a,C(l)&&be(t,l)}}function $e(e,t,n,o){var r,i,a,s,l,d,c,u,p,h,f=e.flags;14&f?(a=t,s=n,l=o,d=0<(4&f),u=(i=e).type,p=i.ref,h=i.props||O,d?($e(d=(c=ue(i,u,h,s)).$LI,a,c.$CX,l),i.dom=d.dom,me(0,p,c),c.$UPD=!1):($e(u=pe(u(h,s),i),a,s,l),i.children=u,i.dom=u.dom,ye(h,p,a))):481&f?ke(e,t,n,o):16&f?(n=e,3!==(o=t).nodeType?(r=fe(n,null),n.dom=r,E(o.parentNode,r,o)):(r=n.children,o.nodeValue!==r&&(o.nodeValue=r),n.dom=o)):512&f?e.dom=t:function(e){throw e=e||g,new Error("Inferno Error: "+e)}()}function Ce(e,t,n,o,r){ie(e),E(n,he(t,null,o,r),e.dom)}function De(e,t,n,o,r){var i,a,s,l,d,c,u,p,h,f,g,v,m,y;e!==t&&(i=0|t.flags,e.flags!==i||2048&i?Ce(e,t,n,o,r):481&i?function(e,t,n,o,r){var i,a=t.type;if(e.type!==a)Ce(e,t,n,o,r);else{var s=e.dom,l=t.flags,d=e.props,c=t.props,u=!1,p=!1;if(t.dom=s,r=r||0<(32&l),d!==c){var h=d||O;if((i=c||O)!==O)for(var f in(u=0<(448&l))&&(p=oe(i)),i){var g=h[f],v=i[f];g!==v&&de(f,g,v,s,r,p,e)}if(h!==O)for(var m in h)i.hasOwnProperty(m)||k(h[m])||de(m,h[m],null,s,r,p,e)}var y=e.children,b=t.children,n=t.ref,d=e.className,c=t.className;y!==b&&_e(e.childFlags,t.childFlags,y,b,s,o,r&&"foreignObject"!==a),u&&te(l,t,s,i,!1,p),d!==c&&(k(c)?s.removeAttribute("class"):r?s.setAttribute("class",c):s.className=c),C(n)&&e.ref!==n&&be(s,n)}}(e,t,n,o,r):14&i?(l=e,c=n,u=o,p=r,h=0<(4&i),v=(d=t).type,m=l.key,y=d.key,l.type!==v||m!==y?Ce(l,d,c,u,p):(f=d.props||O,h?((g=l.children).$UPD=!0,g.$V=d,xe(g,g.state,d,f,c,u,p,!1,!1),g.$UPD=!1):(r=!0,m=l.props,y=d.ref,h=!k(y),g=l.children,d.dom=l.dom,d.children=g,h&&C(y.onComponentShouldUpdate)&&(r=y.onComponentShouldUpdate(m,f)),!1!==r?(h&&C(y.onComponentWillUpdate)&&y.onComponentWillUpdate(m,f),(v=v(f,u))!==b&&(v=pe(v,d),De(g,v,c,u,p),d.children=v,d.dom=v.dom,h&&C(y.onComponentDidUpdate)&&y.onComponentDidUpdate(m,f))):14&g.flags&&(g.parentVNode=d)))):16&i?(g=e,d=n,n=(a=t).children,D(d.firstChild)?(d.textContent=n,s=d.firstChild):(s=g.dom,n!==g.children&&(s.nodeValue=n)),a.dom=s):512&i?t.dom=e.dom:(a=t,s=o,t=(i=e).type,o=a.type,e=a.children,_e(i.childFlags,a.childFlags,i.children,e,t,s,!1),a.dom=i.dom,t===o||$(e)||(e=e.dom,t.removeChild(e),o.appendChild(e))))}function _e(e,t,n,o,r,i,a){switch(e){case 2:switch(t){case 2:De(n,o,r,i,a);break;case 1:re(n,r);break;default:re(n,r),ve(o,r,i,a)}break;case 1:switch(t){case 2:he(o,r,i,a);break;case 1:break;default:ve(o,r,i,a)}break;default:var s,l;12&t?(s=n.length,l=o.length,0===s?0<l&&ve(o,r,i,a):0===l?se(r,n):(8===t&&8===e?function(e,t,n,o,r,i,a){var s,l,d=i-1,c=a-1,u=0,p=e[u],h=t[u];e:{for(;p.key===h.key;){if(h.dom&&(t[u]=h=w(h)),De(p,h,n,o,r),e[u]=h,d<++u||c<u)break e;p=e[u],h=t[u]}for(p=e[d],h=t[c];p.key===h.key;){if(h.dom&&(t[c]=h=w(h)),De(p,h,n,o,r),e[d]=h,c--,--d<u||c<u)break e;p=e[d],h=t[c]}}if(d<u){if(u<=c)for(var f=(l=c+1)<a?t[l].dom:null;u<=c;)(h=t[u]).dom&&(t[u]=h=w(h)),u++,U(n,he(h,null,o,r),f)}else if(c<u)for(;u<=d;)re(e[u++],n);else{var g=u,v=u,m=d-u+1,y=c-u+1,b=[];for(s=0;s<y;s++)b.push(0);var k=m===i,$=!1,C=0,D=0;if(a<4||(m|y)<32)for(s=g;s<=d;s++)if(p=e[s],D<y){for(u=v;u<=c;u++)if(h=t[u],p.key===h.key){if(b[u-v]=s+1,k)for(k=!1;g<s;)re(e[g++],n);u<C?$=!0:C=u,h.dom&&(t[u]=h=w(h)),De(p,h,n,o,r),D++;break}!k&&c<u&&re(p,n)}else k||re(p,n);else{var _={};for(s=v;s<=c;s++)_[t[s].key]=s;for(s=g;s<=d;s++)if(p=e[s],D<y)if(void 0!==(u=_[p.key])){if(k)for(k=!1;g<s;)re(e[g++],n);h=t[u],b[u-v]=s+1,u<C?$=!0:C=u,h.dom&&(t[u]=h=w(h)),De(p,h,n,o,r),D++}else k||re(p,n);else k||re(p,n)}if(k)se(n,e),ve(t,n,o,r);else if($){var x=function(e){var t,n,o,r,i,a=e.slice(),s=[0],l=e.length;for(t=0;t<l;t++){var d=e[t];if(0!==d)if(n=s[s.length-1],e[n]<d)a[t]=n,s.push(t);else{for(o=0,r=s.length-1;o<r;)e[s[i=(o+r)/2|0]]<d?o=1+i:r=i;d<e[s[o]]&&(0<o&&(a[t]=s[o-1]),s[o]=t)}}o=s.length,r=s[o-1];for(;0<o--;)s[o]=r,r=a[r];return s}(b);for(u=x.length-1,s=y-1;0<=s;s--)0===b[s]?((h=t[C=s+v]).dom&&(t[C]=h=w(h)),l=C+1,U(n,he(h,null,o,r),l<a?t[l].dom:null)):u<0||s!==x[u]?(h=t[C=s+v],l=C+1,U(n,h.dom,l<a?t[l].dom:null)):u--}else if(D!==y)for(s=y-1;0<=s;s--)0===b[s]&&((h=t[C=s+v]).dom&&(t[C]=h=w(h)),l=C+1,U(n,he(h,null,o,r),l<a?t[l].dom:null))}}:function(e,t,n,o,r,i,a){for(var s,l,d=a<i?a:i,c=0;c<d;c++)s=t[c],l=e[c],s.dom&&(s=t[c]=w(s)),De(l,s,n,o,r),e[c]=s;if(i<a)for(c=d;c<a;c++)(s=t[c]).dom&&(s=t[c]=w(s)),he(s,n,o,r);else if(a<i)for(c=d;c<i;c++)re(e[c],n)})(n,o,r,i,a,s,l)):1===t?se(r,n):(se(r,n),he(o,r,i,a))}}function xe(e,t,n,o,r,i,a,s,l){var d=e.state,c=e.props;if(!(n.children=e).$UN){if(c!==o||o===O){if(!l&&C(e.componentWillReceiveProps)){if(e.$BR=!0,e.componentWillReceiveProps(o,i),e.$UN)return;e.$BR=!1}e.$PSS&&(t=p(t,e.$PS),e.$PSS=!1,e.$PS=null)}var u,l=Boolean(e.shouldComponentUpdate);s||!l||l&&e.shouldComponentUpdate(o,t,i)?(C(e.componentWillUpdate)&&(e.$BS=!0,e.componentWillUpdate(o,t,i),e.$BS=!1),e.props=o,e.state=t,e.context=i,C(S.beforeRender)&&S.beforeRender(e),s=e.render(o,t,i),C(S.afterRender)&&S.afterRender(e),l=s!==b,C(e.getChildContext)&&(u=e.getChildContext()),u=k(u)?i:p(i,u),e.$CX=u,l&&(De(e.$LI,e.$LI=pe(s,n),r,u,a),C(e.componentDidUpdate)&&e.componentDidUpdate(c,d))):(e.props=o,e.state=t,e.context=i),n.dom=e.$LI.dom}}e&&document.body;function we(e,t,n){if(e!==b){var o=t.$V;return k(o)?$(e)||(e.dom&&(e=w(e)),D(t.firstChild)?(he(e,t,O,!1),t.$V=e):function(e,t,n){var o=t.firstChild;if(!D(o))for($(e)||$e(e,o,O,!1),o=t.firstChild;o=o.nextSibling;)t.removeChild(o);0<T.length&&M(T),t.$V=e,C(n)&&n()}(e,t),o=e):k(e)?(re(o,t),t.$V=null):(e.dom&&(e=w(e)),De(o,e,t,O,!1),o=t.$V=e),0<T.length&&M(T),C(n)&&n(),C(S.renderComplete)&&S.renderComplete(o),o&&14&o.flags&&o.children}}var Se="undefined"==typeof Promise?null:Promise.resolve(),Ne="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame.bind(window);function Pe(e,t,n,o){C(t)&&(t=t(e.state,e.props,e.context));var r,i,a,s,l=e.$PS;if(k(l))e.$PS=t;else for(var d in t)l[d]=t[d];e.$PSS||e.$BR?(e.$PSS=!0,e.$BR&&C(n)&&T.push(n.bind(e))):e.$UPD?(D(r=e.$QU)&&(r=e.$QU=[],a=e,s=r,i=function(){a.$QU=null,a.$UPD=!0,Oe(a,!1,function(){for(var e=0,t=s.length;e<t;e++)s[e].call(a)}),a.$UPD=!1},Se?Se.then(i):Ne(i)),C(n)&&r.push(n)):(e.$PSS=!0,e.$UPD=!0,Oe(e,o,n),e.$UPD=!1)}function Oe(e,t,n){if(!e.$UN){if(t||!e.$BR){e.$PSS=!1;var o=e.$PS,r=p(e.state,o),i=e.props,a=e.context;e.$PS=null;var s=e.$V,o=e.$LI;if(xe(e,r,s,i,o.dom&&o.dom.parentNode,a,0<(32&s.flags),t,!0),e.$UN)return;if(0==(1024&e.$LI.flags))for(var l=e.$LI.dom;!D(s=s.parentVNode);)0<(14&s.flags)&&(s.dom=l);0<T.length&&M(T)}else e.state=e.$PS,e.$PS=null;C(n)&&n.call(e)}}t=function(e,t){this.state=null,this.$BR=!1,this.$BS=!0,this.$PSS=!1,this.$PS=null,this.$LI=null,this.$V=null,this.$UN=!1,this.$CX=null,this.$UPD=!0,this.$QU=null,this.props=e||O,this.context=t||O};t.prototype.forceUpdate=function(e){this.$UN||Pe(this,{},e,!0)},t.prototype.setState=function(e,t){this.$UN||this.$BS||Pe(this,e,t,!1)},t.prototype.render=function(e,t,n){};var Te=12,Le=37,Ue=38,Ee=39,Me=40;function Fe(){return{text:"New Node",itree:{state:{editing:!0,focused:!0}}}}var Ie=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(e,t,n){return t&&Ae(e.prototype,t),n&&Ae(e,n),e};function Ae(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},e=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Re=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},je=(e(Be,t),n(Be,[{key:"click",value:function(e){function t(){n.props.node.toggleCheck()}var n=this;this.props.dom._tree.emit("node.click",e,this.props.node,t),e.treeDefaultPrevented||t()}},{key:"render",value:function(){return a(64,"input",null,null,1,{checked:this.props.checked,indeterminate:this.props.indeterminate,onClick:this.click.bind(this),type:"checkbox"})}}]),Be);function Be(){return Ie(this,Be),Re(this,(Be.__proto__||Object.getPrototypeOf(Be)).apply(this,arguments))}function We(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"li",n=e.itree[t].attributes,t=[],n=n.class||n.className;return s.isFunction(n)&&(n=n(e)),s.isEmpty(n)||(s.isString(n)?t=t.concat(n.split(/[\s\.]+/)):s.isArray(n)&&(t=t.concat(n))),t}var He=(e(qe,t),n(qe,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"add",value:function(e){e.stopPropagation(),this.props.node.addChild(Fe()),this.props.node.expand()}},{key:"edit",value:function(e){e.stopPropagation(),this.props.node.toggleEditing()}},{key:"remove",value:function(e){e.stopPropagation(),this.props.node.remove()}},{key:"render",value:function(){var e=[];return this.props.dom._tree.config.editing.edit&&e.push(a(1,"a","btn icon icon-pencil",null,1,{onclick:this.edit.bind(this),title:"Edit this node"})),this.props.dom._tree.config.editing.add&&e.push(a(1,"a","btn icon icon-plus",null,1,{onclick:this.add.bind(this),title:"Add a child node"})),this.props.dom._tree.config.editing.remove&&e.push(a(1,"a","btn icon icon-minus",null,1,{onclick:this.remove.bind(this),title:"Remove this node"})),a(1,"span","btn-group",e,0)}}]),qe);function qe(){return Ie(this,qe),Re(this,(qe.__proto__||Object.getPrototypeOf(qe)).apply(this,arguments))}var Ke=(e(Xe,t),n(Xe,[{key:"render",value:function(){return a(1,"ol",null,a(1,"li","leaf",a(1,"span","title icon icon-file-empty empty",this.props.text,0),2),2)}}]),Xe);function Xe(){return Ie(this,Xe),Re(this,(Xe.__proto__||Object.getPrototypeOf(Xe)).apply(this,arguments))}function Qe(t,n){var o=n.dirty||!1;return o||s.each(Object.keys(n),function(e){if("dirty"!==e&&n[e]!==t[e])return!(o=!0)}),o}var ze=(e(Ge,t),n(Ge,[{key:"getStateFromNodes",value:function(e){return{text:e.text}}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.getStateFromNodes(e.node))}},{key:"shouldComponentUpdate",value:function(e,t){return Qe(this.state,t)}},{key:"click",value:function(e){function t(){n.props.node.toggleCheck()}var n=this;this.props.dom._tree.emit("node.click",e,this.props.node,t),e.treeDefaultPrevented||t()}},{key:"keypress",value:function(e){if(e.which===Te)return this.save()}},{key:"input",value:function(e){this.setState({text:e.target.value})}},{key:"cancel",value:function(e){e&&e.stopPropagation(),this.props.node.toggleEditing()}},{key:"save",value:function(e){e&&e.stopPropagation();var t=this.props.node.text,e=this.ref.value;this.props.node.set("text",e),this.props.node.state("editing",!1),this.props.node.markDirty(),this.props.dom._tree.applyChanges(),t!==e&&this.props.dom._tree.emit("node.edited",this.props.node,t,e)}},{key:"render",value:function(){var t=this;return a(1,"form",null,[a(64,"input",null,null,1,{onClick:function(e){return e.stopPropagation},onInput:this.input.bind(this),onKeyPress:this.keypress.bind(this),value:this.state.text},null,function(e){return t.ref=e}),a(1,"span","btn-group",[a(1,"button","btn icon icon-check",null,1,{onClick:this.save.bind(this),title:"Save",type:"button"}),a(1,"button","btn icon icon-cross",null,1,{onClick:this.cancel.bind(this),title:"Cancel",type:"button"})],4)],4,{onsubmit:function(e){return e.preventDefault}})}}]),Ge);function Ge(e){Ie(this,Ge);var t=Re(this,(Ge.__proto__||Object.getPrototypeOf(Ge)).call(this,e));return t.state=t.getStateFromNodes(e.node),t}var Ye=(e(Je,t),n(Je,[{key:"blur",value:function(){this.props.node.blur()}},{key:"click",value:function(t){var n=this,e=this.props,o=e.node,r=e.dom,e=function(){var e;t.preventDefault(),n.props.editing||((t.metaKey||t.ctrlKey||t.shiftKey)&&r._tree.disableDeselection(),t.shiftKey&&(r.clearSelection(),(e=r._tree.lastSelectedNode())&&r._tree.selectBetween.apply(r._tree,r._tree.boundingNodes(e,o))),o.selected()?r._tree.config.selection.disableDirectDeselection||o.deselect():o.select(),r._tree.enableDeselection())};r._tree.emit("node.click",t,o,e),t.treeDefaultPrevented||e()}},{key:"contextMenu",value:function(e){var t=this.props,n=t.node;t.dom._tree.emit("node.contextmenu",e,n)}},{key:"dblclick",value:function(e){var t=this.props,n=t.node,o=t.dom,t=function(){o.clearSelection(),n.toggleCollapse()};o._tree.emit("node.dblclick",e,n,t),e.treeDefaultPrevented||t()}},{key:"focus",value:function(e){this.props.node.focus(e)}},{key:"mousedown",value:function(){this.props.dom.isDragDropEnabled&&(this.props.dom.isMouseHeld=!0)}},{key:"render",value:function(){var e=this.props.node,t=s.clone(e.itree.a.attributes)||{};t.tabindex=1,t.unselectable="on";var n=We(e,"a").concat(["title","icon"]),o=this.props.expanded?"icon-folder-open":"icon-folder";n.push(e.itree.icon||(this.props.hasOrWillHaveChildren?o:"icon-file-empty")),t.class=t.className=n.join(" ");n=e.text;return e.editing()&&(n=l(2,ze,{dom:this.props.dom,node:this.props.node})),r(a(1,"a",null,n,0,Ve({"data-uid":e.id,onBlur:this.blur.bind(this),onClick:this.click.bind(this),onContextMenu:this.contextMenu.bind(this),onDblClick:this.dblclick.bind(this),onFocus:this.focus.bind(this),onMouseDown:this.mousedown.bind(this)},t)))}}]),Je);function Je(){return Ie(this,Je),Re(this,(Je.__proto__||Object.getPrototypeOf(Je)).apply(this,arguments))}var Ze=(e(et,t),n(et,[{key:"className",value:function(){return"toggle icon "+(this.props.collapsed?"icon-expand":"icon-collapse")}},{key:"render",value:function(){return a(1,"a",this.className(),null,1,{onClick:this.props.node.toggleCollapse.bind(this.props.node)})}}]),et);function et(){return Ie(this,et),Re(this,(et.__proto__||Object.getPrototypeOf(et)).apply(this,arguments))}var tt=(e(nt,t),n(nt,[{key:"stateFromNode",value:function(e){return{dirty:e.itree.dirty}}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.stateFromNode(e.node))}},{key:"shouldComponentUpdate",value:function(e,t){return t.dirty}},{key:"getAttributes",value:function(){var e=this.props.node,t=s.clone(e.itree.li.attributes)||{};return t.class=t.className=this.getClassNames(),t["data-uid"]=e.id,this.props.dom.config.dragAndDrop.enabled&&(t.draggable=e.state("draggable"),t.onDragEnd=this.onDragEnd.bind(this),t.onDragEnter=this.onDragEnter.bind(this),t.onDragLeave=this.onDragLeave.bind(this),t.onDragStart=this.onDragStart.bind(this),e.state("drop-target")?(t.onDragOver=this.onDragOver.bind(this),t.onDrop=this.onDrop.bind(this)):(t.onDragOver=null,t.onDrop=null)),t}},{key:"getClassNames",value:function(){var e=this.props.node,t=e.itree.state,n=We(e);return s.each(Object.keys(t),function(e){t[e]&&n.push(e)}),!e.hidden()&&e.removed()&&n.push("hidden"),e.expanded()&&n.push("expanded"),n.push(e.hasOrWillHaveChildren()?"folder":"leaf"),n.join(" ")}},{key:"getTargetDirection",value:function(e,t){var n=e.clientY,o=t.getBoundingClientRect(),e=o.top+o.height/3,t=o.bottom-o.height/3,o=0;return n<=e?o=-1:t<=n&&(o=1),o}},{key:"onDragStart",value:function(e){e.stopPropagation(),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move";var n,o,t,r=this.props.node;this.props.dom._activeDragNode=r,e.dataTransfer.setData("treeId",r.tree().id),e.dataTransfer.setData("nodeId",r.id),r.state("drop-target",!1),r.hasChildren()&&r.children.stateDeep("drop-target",!1),"dragstart"===this.props.dom.config.dragAndDrop.validateOn&&(n=this.props.dom.config.dragAndDrop.validate,o=s.isFunction(n),t=function t(e,n){i.isTreeNodes(e)?s.each(e,function(e){t(e,n)}):i.isTreeNode(e)&&!1!==n(e)&&e.hasChildren()&&t(e.children,n)},this.props.dom._tree.batch(),t(this.props.dom._tree.model,function(e){var t=e.id!==r.id;return(t=t&&!e.hasAncestor(r))&&o&&(t=n(r,e)),e.state("drop-target",t),t}),this.props.dom._tree.end()),this.props.dom._tree.emit("node.dragstart",e)}},{key:"onDragEnd",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget(),this.props.dom._tree.emit("node.dragend",e)}},{key:"onDragEnter",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.node.recurseUp(this.unhighlightTarget),this.props.node.state("drag-targeting",!0),this.props.dom._tree.emit("node.dragenter",e)}},{key:"onDragLeave",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget(),this.props.dom._tree.emit("node.dragleave",e)}},{key:"onDragOver",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.dom._activeDragNode,n=this.props.node,o=this.getTargetDirection(e,n.itree.ref.querySelector("a"));if("dragover"===this.props.dom.config.dragAndDrop.validateOn){var r=this.props.dom.config.dragAndDrop.validate,i=s.isFunction(r),a=t.id!==n.id;if((a=a&&!n.hasAncestor(t))&&i&&(a=r(t,n,o)),n.state("drop-target",a),this.props.dom._tree.applyChanges(),!a)return}this.props.dom._tree.batch(),n.state("drag-targeting",!0),n.state("drag-targeting-above",-1===o),n.state("drag-targeting-below",1===o),n.state("drag-targeting-insert",0===o),this.props.dom._tree.end(),this.props.dom._tree.emit("node.dragover",e,o)}},{key:"onDrop",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget();var t=e.dataTransfer.getData("treeId"),n=e.dataTransfer.getData("nodeId"),o=this.props.node;this.props.dom._activeDragNode=null;var r=this.getTargetDirection(e,e.target),i=void 0;t===this.props.dom._tree.id?i=this.props.dom._tree:t&&(i=document.querySelector('[data-uid="'+t+'"]').inspireTree);var a=void 0,t=void 0;i&&((i=i.node(n)).state("drop-target",!0),n=i.remove(!0),i=o.context().indexOf(o),0===r?(a=o.addChild(n),t=o.children.indexOf(a),o.expand()):(t=1===r?++i:i,a=o.context().insertAt(t,n))),this.props.dom._tree.emit("node.drop",e,a,o,t)}},{key:"unhighlightTarget",value:function(e){(e||this.props.node).states(["drag-targeting","drag-targeting-above","drag-targeting-below","drag-targeting-insert"],!1)}},{key:"renderCheckbox",value:function(){var e=this.props.node;if(this.props.dom.config.showCheckboxes)return l(2,je,{checked:e.checked(),dom:this.props.dom,indeterminate:e.indeterminate(),node:e})}},{key:"renderChildren",value:function(){var e=this.props,t=e.node,n=e.dom;if(t.hasChildren()){var o=t.children,r=n.loading,e=o.pagination();return l(2,ot,{context:t,dom:n,limit:e.limit,loading:r,nodes:o,total:e.total})}if(this.props.dom.isDynamic&&t.children)return t.hasLoadedChildren()?l(2,Ke,{text:"No Results"}):l(2,Ke,{text:"Loading..."})}},{key:"renderEditToolbar",value:function(){if(this.props.dom._tree.config.editing.edit&&!this.props.node.editing())return l(2,He,{dom:this.props.dom,node:this.props.node})}},{key:"renderToggle",value:function(){var e=this.props.node;if(this.props.dom.isDynamic?Boolean(e.children):e.hasVisibleChildren())return l(2,Ze,{collapsed:e.collapsed(),node:e})}},{key:"render",value:function(){var t=this,e=this.props.node,e=r(a(1,"li",null,[this.renderEditToolbar(),a(1,"div","title-wrap",[this.renderToggle(),this.renderCheckbox(),l(2,Ye,{dom:this.props.dom,editing:e.editing(),expanded:e.expanded(),hasOrWillHaveChildren:e.hasOrWillHaveChildren(),node:e,text:e.text})],0),a(1,"div","wholerow"),this.renderChildren()],0,Ve({},this.getAttributes()),null,function(e){return t.node=t.props.node.itree.ref=e}));return this.props.node.state("rendered",!0),this.props.node.itree.dirty=!1,e}}]),nt);function nt(e){Ie(this,nt);var t=Re(this,(nt.__proto__||Object.getPrototypeOf(nt)).call(this,e));return t.state=t.stateFromNode(e.node),t}var ot=(e(rt,t),n(rt,[{key:"shouldComponentUpdate",value:function(e){return s.find(e.nodes,"itree.dirty")||Qe(this.props,e)}},{key:"isDeferred",value:function(){return this.props.dom.config.deferredRendering||this.props.dom._tree.config.deferredLoading}},{key:"loadMore",value:function(e){e.preventDefault(),(this.props.context||this.props.dom._tree).loadMore(e)}},{key:"renderLoadMoreNode",value:function(){return a(1,"li","leaf detached",a(1,"a","title icon icon-more load-more",y("Load More"),2,{onClick:this.loadMore.bind(this)}),2)}},{key:"renderLoadingTextNode",value:function(){return a(1,"li","leaf",a(1,"span","title icon icon-more",y("Loading..."),2),2)}},{key:"render",value:function(){var t,n=this,e=this.props.nodes,o=e.pagination();this.props.dom.config.deferredRendering&&(t=0,e=this.props.nodes.filter(function(e){e=!(e.hidden()||e.removed());return e&&t++,t<=o.limit&&e}));e=s.map(e,function(e){return l(2,tt,{dom:n.props.dom,node:e},e.id)});return this.isDeferred()&&o.limit<o.total&&(this.props.loading?e.push(this.renderLoadingTextNode()):e.push(this.renderLoadMoreNode())),a(1,"ol",null,[e,this.props.children],0)}}]),rt);function rt(){return Ie(this,rt),Re(this,(rt.__proto__||Object.getPrototypeOf(rt)).apply(this,arguments))}var it=(e(at,t),n(at,[{key:"add",value:function(){this.props.dom._tree.focused().blur(),this.props.dom._tree.addNode(Fe())}},{key:"renderAddLink",value:function(){if(this.props.dom._tree.config.editing.add)return a(1,"li",null,a(1,"a","btn icon icon-plus",null,1,{onClick:this.add.bind(this),title:"Add a new root node"}),2)}},{key:"render",value:function(){var e=this.props,t=e.dom,n=e.nodes,o=t.loading,e=n.pagination();return l(2,ot,{dom:t,limit:e.limit,loading:o,nodes:n,total:e.total,children:this.renderAddLink()})}}]),at);function at(){return Ie(this,at),Re(this,(at.__proto__||Object.getPrototypeOf(at)).apply(this,arguments))}function st(e,t){var n=this;if(Ie(this,st),!(e instanceof i))throw new TypeError("Tree argument is not an InspireTree instance.");if(this._tree=e,this.batching=0,this.dropTargets=[],this.$scrollLayer,!t.target)throw new TypeError("Invalid `target` property - must be a selector, HTMLElement, or jQuery element.");var o={enabled:!(e.usesNativeDOM=!0),validateOn:"dragstart",validate:null};this.config=s.defaultsDeep({},t,{autoLoadMore:!0,deferredRendering:!1,dragAndDrop:o,nodeHeight:25,showCheckboxes:!1,tabindex:-1,target:!1}),!0===t.dragAndDrop&&(this.config.dragAndDrop=o,this.config.dragAndDrop.enabled=!0),this.isDynamic=s.isFunction(this._tree.config.data),this.attach(this.config.target);var r=!0;e.on("changes.applied",function(){n.renderNodes(),r&&(n.scrollSelectedIntoView(),r=!1)}),this.renderNodes()}return n(st,[{key:"attach",value:function(e){if(this.$target=this.getElement(e),this.$scrollLayer=this.getScrollableAncestor(this.$target),!this.$target)throw new Error("No valid element to attach to.");this.$target.setAttribute("data-uid",this._tree.id);var n=this.$target.className.split(" ");n.push("inspire-tree"),this._tree.config.editable&&(n.push("editable"),s.each(s.pickBy(this._tree.config.editing,s.identity),function(e,t){n.push("editable-"+t)})),this.$target.className=n.join(" "),this.$target.setAttribute("tabindex",this.config.tabindex||0),this.$target.addEventListener("keydown",this.keyboardListener.bind(this)),this.config.dragAndDrop.enabled&&(this.$target.addEventListener("dragenter",this.onDragEnter.bind(this),!1),this.$target.addEventListener("dragleave",this.onDragLeave.bind(this),!1),this.$target.addEventListener("dragover",this.onDragOver.bind(this),!1),this.$target.addEventListener("drop",this.onDrop.bind(this),!1),this.$target.classList.add("drag-and-drop")),this._tree.on("node.focused",function(e){e=e.itree.ref.querySelector(".title");e!==document.activeElement&&e.focus()}),(this.config.deferredRendering||this._tree.config.deferredLoading)&&(e=this._tree.config.pagination.limit,this._tree.config.pagination.limit=0<e?e:s.ceil(this.$scrollLayer.clientHeight/this.config.nodeHeight),this.config.autoLoadMore&&this.$target.addEventListener("scroll",s.throttle(this.scrollListener.bind(this),20))),this.$target.inspireTree=this._tree}},{key:"clearSelection",value:function(){document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}},{key:"getElement",value:function(e){var t=void 0;return e instanceof HTMLElement?t=e:s.isObject(e)&&s.isObject(e[0])?t=e[0]:!s.isString(e)||(e=document.querySelector(e))&&(t=e),t}},{key:"getScrollableAncestor",value:function(e){return e instanceof Element&&"auto"!==getComputedStyle(e).overflow&&e.parentNode&&(e=this.getScrollableAncestor(e.parentNode)),e}},{key:"keyboardListener",value:function(e){if(e.stopPropagation(),!([Me,Te,Le,Ee,Ue].indexOf(e.which)<0)){var t=this._tree.focused();if(t.length)switch(e.preventDefault(),e.which){case Me:this.moveFocusDownFrom(t[0]);break;case Te:t[0].toggleSelect();break;case Le:t[0].collapse();break;case Ee:t[0].expand();break;case Ue:this.moveFocusUpFrom(t[0])}}}},{key:"moveFocusDownFrom",value:function(e){e=e.nextVisibleNode();e&&e.focus()}},{key:"moveFocusUpFrom",value:function(e){e=e.previousVisibleNode();e&&e.focus()}},{key:"nodeFromTitleDOMElement",value:function(e){e=e.parentNode.parentNode.getAttribute("data-uid");return this._tree.node(e)}},{key:"onDragEnter",value:function(e){e.preventDefault(),e.target.classList.add("drag-targeting","drag-targeting-insert")}},{key:"onDragLeave",value:function(e){e.preventDefault(),this.unhighlightTarget(e.target)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){e.preventDefault(),this.unhighlightTarget(e.target);var t=e.dataTransfer.getData("treeId"),n=e.dataTransfer.getData("nodeId"),t=st.getTreeById(t).node(n);t.state("drop-target",!0);n=t.remove(!0),t=this._tree.addNode(n),n=this._tree.indexOf(t);this._tree.emit("node.drop",e,t,null,n)}},{key:"renderNodes",value:function(e){we(l(2,it,{dom:this,nodes:e||this._tree.nodes()}),this.$target)}},{key:"scrollListener",value:function(n){var o,e,r=this;this.rendering||this.loading||(o=this.$scrollLayer.getBoundingClientRect(),e=document.querySelectorAll(".load-more"),s.each(e,function(e){var t=e.getBoundingClientRect();o.right<t.left||o.left>t.right||o.bottom<t.top||o.top>t.bottom||(t=void 0,"LI"===(e=e.parentNode.parentNode.parentNode).tagName&&(t=r._tree.node(e.getAttribute("data-uid"))),r._tree.loadMore(t,n))}))}},{key:"scrollSelectedIntoView",value:function(){var e=this.$target.querySelector(".selected");e&&this.$scrollLayer&&(this.$scrollLayer.scrollTop=e.offsetTop)}},{key:"unhighlightTarget",value:function(e){e&&e.classList.remove("drag-targeting","drag-targeting-insert")}}],[{key:"getTreeById",value:function(e){e=document.querySelector('[data-uid="'+e+'"]');if(e)return e.inspireTree}}]),st});